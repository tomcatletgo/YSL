<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ycw.system.dao.DepartDao">
<!-- 查询部门机构表 -->
	<select id="getDepartList" resultType="ycw.system.vo.DepartVo" parameterType="map">
	
		select
	        depart.ID as id,
	        depart.parentdepartid as parentId ,
	        depart.departname as departname,
	        depart.description as description,
	        depart.isDelete as isDelete ,
	        depart.departcode as departcode
	    from
	        t_s_depart depart 
	    where depart.isDelete = #{isDelete}
		
		<if test="parentId != '' and parentId != null">
			AND depart.parentdepartid = #{parentId}
		</if>
		
		<if test="departid != '' and departid != null">
			AND depart.id = #{departid} 
		</if>
	</select>
	
	<select id="getChildList" parameterType="string" resultType="int">
		select count(ID)
		  from t_s_depart
		 where parentdepartid = #{parentId}
		 and  isDelete = 0
	</select>
	
	
	<select id="getIconPath" parameterType="string" resultType="String">
		select path
		  from t_s_icon
		 where id = #{id}
	</select>
	
	
	<!-- 查询t_s_depart -->
	<select id="getList"  resultType="ycw.system.vo.DepartVo">
		select *
		  from t_s_depart
		 where  isDelete = 0
	</select>
	
	<!-- 查询t_s_depart -->
	<select id="getById"  resultType="ycw.system.vo.DepartVo" parameterType="String">
		select *
		  from t_s_depart
		where id = #{id}
		  and  isDelete = 0
	</select>
	
		<!--查询t_s_depart  -->
	<select id="getComboTree"  resultType="ycw.system.vo.DepartVo" parameterType="map">
		select *
		  from t_s_depart
		where isDelete = 0
		
		<if test="selfId != '' and selfId != null">
			AND id != #{selfId}
		</if>
		
		<if test="departId != '' and departId != null">
			AND id = #{departId} 
		</if>
		
		
		<if test="pId != '' and pId != null">
			AND parentdepartid = #{pId} 
		</if>
		
		
	</select>
	<!--  查询t_s_depart（部门一致性） -->	
	<select id="checkDepartName"  resultType="ycw.system.vo.DepartVo" parameterType="map">
		select *
		  from t_s_depart
		where isDelete = 0
		
		<if test="departId != '' and departId != null">
			AND id != #{departId}
		</if>
		
		<if test="departName != '' and departName != null">
			AND departName = #{departName} 
		</if>
	</select>
	
	<!--  查询t_s_depart（部门编码一致性） -->	
	<select id="checkDepartCode"  resultType="ycw.system.vo.DepartVo" parameterType="map">
		select *
		  from t_s_depart
		where isDelete = 0
		
		<if test="departId != '' and departId != null">
			AND id != #{departId}
		</if>
		
		<if test="departCode != '' and departCode != null">
			AND departCode = #{departCode} 
		</if>
	</select>
	
	<!--添加部门  -->	
	<insert id="save" parameterType="map">
		insert 
		    into
		        t_s_depart
		        (parentdepartid, departname, description, isDelete, ID,departcode) 
		    values
		        (#{departId}, #{departname}, #{description}, #{isDelete}, #{id}, #{departcode})
	</insert>
	<!--  修改部门信息-->	
	<update id="update">
		update
	        t_s_depart 
	    set
	        parentdepartid=#{parentdepartid},
	        departname=#{departname},
	        description=#{description},
	        departcode=#{departcode}
	    where
	        ID=#{id}
	</update>
	<!--查询t_s_depart（获取子部门Id）  -->	
	<select id="getChildDepart" resultType="ycw.system.vo.DepartVo" parameterType="String">
		select *
		  from t_s_depart
		 where parentdepartid = #{parentId}
		  and  isDelete = 0
	</select>
		<!--查询t_s_base_user（部门相关用户信息）  -->
	<select id="getUserList" resultType="ycw.system.pojo.base.TSUser" parameterType="String">
		select *
		  from t_s_base_user
		 where departid = #{id}
		  and  isDelete = 0
	</select>
		<!-- 查询t_b_device（相关终端信息） -->
		<!-- 
	<select id="getDevice" resultType="ycw.module.entity.TBDevice" parameterType="String">
		select *
		  from t_b_device
		 where departid = #{id}
		  and  isDelete = 0
	</select>
	
	 查询t_b_sim（相关SIM卡信息）	
	<select id="getSimList" resultType="ycw.module.entity.TBSim" parameterType="String">
		select *
		  from t_b_sim
		 where departid = #{id}
		  and  isDelete = 0
	</select>
	查询t_b_ammeter（相关电表信息）	
	<select id="getAmmeter" resultType="ycw.module.entity.TBAmmeter" parameterType="String">
		select *
		  from t_b_ammeter
		 where departid = #{id}
		  and  isDelete = 0
	</select>
	查询t_b_ammeterbox（相关电表信息）	
	<select id="getAmmeterBox" resultType="ycw.module.entity.TBAmmeterBox" parameterType="String">
		select *
		  from t_b_ammeterbox
		 where departid = #{id}
		  and  isDelete = 0
	</select>
	
	 查询t_b_collector（相关采集器信息）	
	<select id="getCollector" resultType="ycw.module.entity.TBCollector" parameterType="String">
		select *
		  from t_b_collector
		 where departid = #{id}
		  and  isDelete = 0
	</select>
	 查询t_b_concentrator（相关集中器信息）	
	<select id="getConcentrator" resultType="ycw.module.entity.TBConcentrator" parameterType="String">
		select *
		  from t_b_concentrator
		 where departid = #{id}
		  and  isDelete = 0
	</select> -->
	<!--   删除-->	
	<update id="deleteDepart" parameterType="String">
		
		update
	        t_s_depart 
	    set
	        isDelete= 1
	    where
	        ID=#{id}
	
	</update>
	<!-- 查询部门 -->
	 <select id="getDepart" resultType="ycw.system.pojo.base.TSDepart" parameterType="map" >
	    select
	        tsdepart0_.ID as ID1_41_0_,
	        tsdepart0_.parentdepartid as parentde5_41_0_,
	        tsdepart0_.departname as departna2_41_0_,
	        tsdepart0_.description as descript3_41_0_,
	        tsdepart0_.isDelete as isDelete4_41_0_ 
	    from
	        t_s_depart tsdepart0_ 
	    where
	        1=1
	 	<if test = "departid != '' and departid != null"> 
			AND tsdepart0_.ID= #{departid}
		</if>
	 		
	 </select>
	
</mapper>